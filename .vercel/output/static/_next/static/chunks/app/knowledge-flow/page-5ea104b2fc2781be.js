(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[542],{9084:function(e,t,s){Promise.resolve().then(s.bind(s,4147))},4147:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return k}});var n=s(3827),a=s(4090),l=s(5754),r=s(6964),o=s(94),c=s(1472);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(7977).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var d=s(9259),m=s(8025),h=s(703),g=s(4232),u=s(4129),x=s(1669),f=s(5624),p=s(3803),w=s(8978),j=s(7788),N=s(2680);let v=e=>{let{children:t}=e,[s,l]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{l(!0)},[]),s?(0,n.jsx)(n.Fragment,{children:t}):null},y=(0,g.default)(()=>s.e(230).then(s.bind(s,6230)).then(e=>e.KnowledgeGraphView),{loadableGenerated:{webpack:()=>[6230]},ssr:!1,loading:()=>(0,n.jsx)("div",{className:"flex items-center justify-center h-[50vh]",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})});function k(){let{t:e}=(0,f.Z)(),{toast:t}=(0,j.pm)(),[s,g]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[b,_]=(0,a.useState)([]),[E,A]=(0,a.useState)([]),[D,C]=(0,a.useState)([]),[I,O]=(0,a.useState)(!0),[z,J]=(0,a.useState)(!1);(0,a.useEffect)(()=>{try{let e=setTimeout(()=>{try{let e=localStorage.getItem("knowledge_flow_nodes"),t=localStorage.getItem("knowledge_flow_links"),s=localStorage.getItem("knowledge_flow_recent_nodes");if(e){let t=JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}));_(t)}if(t&&A(JSON.parse(t)),s){let e=JSON.parse(s).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}));C(e)}}catch(e){console.error("Error loading nodes from localStorage:",e)}},100);return()=>clearTimeout(e)}catch(e){console.error("Error in localStorage load effect:",e)}},[]);let Z=(0,a.useCallback)(()=>{if(0!==b.length)try{localStorage.setItem("knowledge_flow_nodes",JSON.stringify(b))}catch(e){console.error("Error saving nodes to localStorage:",e)}},[b]),F=(0,a.useCallback)(()=>{if(0!==E.length)try{localStorage.setItem("knowledge_flow_links",JSON.stringify(E))}catch(e){console.error("Error saving links to localStorage:",e)}},[E]),L=(0,a.useCallback)(()=>{if(0!==D.length)try{localStorage.setItem("knowledge_flow_recent_nodes",JSON.stringify(D))}catch(e){console.error("Error saving recent nodes to localStorage:",e)}},[D]);(0,a.useEffect)(()=>{Z()},[Z]),(0,a.useEffect)(()=>{F()},[F]),(0,a.useEffect)(()=>{L()},[L]),(0,a.useEffect)(()=>{let s=async()=>{if(b.length>=2){let s=b[b.length-1],n=b.slice(0,b.length-1),a="以下の新しいノードと既存のノードの関連性を評価してください。関連性の強さを0から1の間で評価し、0.5以上の関連性があるノードのIDと関連性の強さをJSON形式で返してください。\n\n新しいノード:\nID: ".concat(s.id,"\nタイトル: ").concat(s.title,"\n内容: ").concat(s.content,"\nタグ: ").concat(s.tags.join(", "),"\n\n既存のノード:\n").concat(n.map(e=>"ID: ".concat(e.id,"\nタイトル: ").concat(e.title,"\n内容: ").concat(e.content,"\nタグ: ").concat(e.tags.join(", "),"\n---")).join("\n"),'\n\n返答形式:\n{\n  "relationships": [\n    {"source": "新しいノードID", "target": "関連ノードID", "value": 関連性の強さ(0.5から1の間の数値)},\n    ...\n  ]\n}');try{let s=await (0,N.oJ)(a),n=(0,N.qj)(s);console.log("Cleaned AI response:",n);let l=JSON.parse(n);if(l.relationships&&l.relationships.length>0){let s=l.relationships.map(e=>({source:e.source,target:e.target,value:e.value}));A(e=>[...e,...s]),t({title:e("relationshipsAnalyzed"),description:e("aiFoundRelationships").replace("{count}",s.length.toString()),duration:3e3})}}catch(e){console.error("Error analyzing relationships:",e)}}};b.length>1&&s()},[b.length,t,e]);let P=async s=>{let n=s.title,a=s.content,l=[...s.tags];if(n.length<10&&a.length>0){J(!0);try{let s="以下の短いタイトルと内容から、より具体的で分かりやすいタイトル（20-30文字程度）を生成してください。日本語で返答してください。\nタイトル: ".concat(n,"\n内容: ").concat(a);if(n=(await (0,N.oJ)(s)).trim(),0===l.length){let e='以下の内容に最適なタグを3つ以内で提案してください。各タグは一単語で、スペースを含まないこと。配列形式で返してください。例: ["タグ1", "タグ2", "タグ3"]\nタイトル: '.concat(n,"\n内容: ").concat(a),t=await (0,N.oJ)(e);try{let e=JSON.parse(t);Array.isArray(e)&&(l=e.map(e=>e.startsWith("#")?e:"#".concat(e)))}catch(e){console.error("タグの解析に失敗:",e)}}t({title:e("titleEnhanced"),description:e("aiEnhancedTitle"),duration:3e3})}catch(e){console.error("タイトル拡張エラー:",e)}finally{J(!1)}}let r={id:Date.now().toString(),title:n,content:a,tags:l,createdAt:new Date,updatedAt:new Date,position:{x:0,y:0},type:"text"};_(e=>[...e,r]),C(e=>[r,...e])},T=async()=>{S(!0)};return(0,a.useEffect)(()=>{let e=window.onerror,t=t=>t.message&&(t.message.includes("message channel closed")||t.message.includes("asynchronous response"))?(t.preventDefault(),t.stopPropagation(),!0):!!e&&e.apply(window,[t.message,t.filename,t.lineno,t.colno,t.error]);return window.addEventListener("error",t),()=>{window.removeEventListener("error",t)}},[]),(0,a.useEffect)(()=>{let e=window.onunhandledrejection,t=t=>t.reason&&"string"==typeof t.reason.message&&(t.reason.message.includes("message channel closed")||t.reason.message.includes("asynchronous response"))?(t.preventDefault(),!0):!!e&&e.apply(window,[t]);return window.addEventListener("unhandledrejection",t),()=>{window.removeEventListener("unhandledrejection",t)}},[]),(0,n.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,n.jsx)(p.SiteHeader,{}),(0,n.jsxs)("main",{className:"flex-1 flex flex-col pt-16",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-background",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(l.z,{variant:"outline",size:"icon",onClick:()=>O(!I),children:(0,n.jsx)(r.Z,{className:"h-4 w-4"})}),(0,n.jsx)("h1",{className:"text-lg font-medium",children:e("knowledgeFlow")})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(l.z,{variant:"outline",size:"sm",className:"gap-1.5",onClick:()=>g(!0),children:[(0,n.jsx)(o.Z,{className:"h-4 w-4"}),e("addNode")]}),(0,n.jsxs)(l.z,{variant:"outline",size:"sm",className:"gap-1.5",onClick:T,children:[(0,n.jsx)(c.Z,{className:"h-4 w-4"}),e("askAi")]}),b.length>0&&(0,n.jsxs)(l.z,{variant:"outline",size:"sm",className:"gap-1.5 text-destructive hover:text-destructive",onClick:()=>{window.confirm(e("confirmClearAllNodes"))&&(_([]),A([]),C([]),localStorage.removeItem("knowledge_flow_nodes"),localStorage.removeItem("knowledge_flow_links"),localStorage.removeItem("knowledge_flow_recent_nodes"),t({title:e("nodesCleared"),description:e("allNodesCleared"),duration:3e3}))},children:[(0,n.jsx)(i,{className:"h-4 w-4"}),e("clearAll")]})]})]}),(0,n.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[I&&(0,n.jsxs)("div",{className:"w-64 border-r bg-muted/20 overflow-auto p-4",children:[(0,n.jsx)("h3",{className:"font-medium mb-3",children:e("recentlyAdded")}),(0,n.jsx)("div",{className:"space-y-2",children:D.length>0?D.map(e=>(0,n.jsxs)("div",{className:"bg-background rounded-md p-3 border node-card cursor-pointer hover:bg-muted/40",children:[(0,n.jsx)("h4",{className:"font-medium text-sm truncate",children:e.title}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:e.content}),e.tags.length>0&&(0,n.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.tags.slice(0,2).map((e,t)=>(0,n.jsx)("span",{className:"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded",children:e},t)),e.tags.length>2&&(0,n.jsxs)("span",{className:"text-[10px] bg-muted text-muted-foreground px-1.5 py-0.5 rounded",children:["+",e.tags.length-2]})]})]},e.id)):(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:e("noNodesYet")})})]}),(0,n.jsx)("div",{className:"flex-1 overflow-auto p-2",children:(0,n.jsx)(v,{children:(0,n.jsx)(y,{nodes:b,recentNodes:D,links:E})})})]}),0===b.length&&(0,n.jsx)("section",{className:"container py-12",children:(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2 lg:gap-12 items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-3xl font-bold tracking-tighter sm:text-4xl",children:e("knowledgeFlow")}),(0,n.jsx)("p",{className:"mt-4 text-muted-foreground",children:e("knowledgeFlowDescription")}),(0,n.jsxs)("ul",{className:"mt-6 space-y-4",children:[(0,n.jsxs)("li",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"mr-2 flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",children:(0,n.jsx)(d.Z,{className:"h-4 w-4 text-primary"})}),(0,n.jsx)("span",{children:e("visualConnections")})]}),(0,n.jsxs)("li",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"mr-2 flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",children:(0,n.jsx)(d.Z,{className:"h-4 w-4 text-primary"})}),(0,n.jsx)("span",{children:e("tagsOrganize")})]}),(0,n.jsxs)("li",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"mr-2 flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",children:(0,n.jsx)(d.Z,{className:"h-4 w-4 text-primary"})}),(0,n.jsx)("span",{children:e("aiAssistance")})]})]}),(0,n.jsx)("div",{className:"mt-8",children:(0,n.jsxs)(l.z,{onClick:()=>g(!0),className:"gap-2",children:[e("addNode"),(0,n.jsx)(m.Z,{className:"h-4 w-4"})]})})]}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("div",{className:"relative h-[400px] w-full overflow-hidden rounded-xl border bg-background p-2",children:(0,n.jsx)(h.default,{src:"/images/knowledge-flow-sample.svg",alt:e("knowledgeFlowExample"),fill:!0,className:"object-contain"})})})]})})]}),(0,n.jsx)(w.SiteFooter,{}),(0,n.jsx)(u.P,{isOpen:s,onClose:()=>g(!1),onSave:P,isProcessing:z}),(0,n.jsx)(x.j,{isOpen:k,onClose:()=>S(!1),onSaveAsNode:(e,t)=>{let s={id:Date.now().toString(),title:e,content:t,tags:[],createdAt:new Date,updatedAt:new Date,position:{x:0,y:0},type:"text"};_(e=>[...e,s]),C(e=>[s,...e].slice(0,5)),S(!1)}})]})}}},function(e){e.O(0,[777,632,981,35,124,872,410,971,69,744],function(){return e(e.s=9084)}),_N_E=e.O()}]);